<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>BurgerCraft üçî</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>üçî BurgerCraft - You choose the taste!</h1>

    <form action="fidelity.php" method="POST" id="burgerForm">
        <!-- Dati utente -->
        <fieldset>
            <legend>Dati Utente</legend>
            <label>
                Nome e Cognome:<br>
                <input type="text" name="nome" id="nome" required minlength="3" maxlength="40">
            </label>
            <label>
                Data e Ora prenotazione:<br>
                <input type="datetime-local" name="dataPrenotazione" id="dataPrenotazione" required>
            </label>
        </fieldset>

        <!-- Scelta Pane -->
        <fieldset>
            <legend>Scegli il tipo di pane</legend>
            <label>
                <img src="img/pane_normale.png" alt="Pane normale">
                <input type="radio" name="pane" value="normale" data-prezzo="2" required> Pane normale
            </label>
            <label>
                <img src="img/pane_integrale.png" alt="Pane integrale">
                <input type="radio" name="pane" value="integrale" data-prezzo="2.5"> Pane integrale
            </label>
            <label>
                <img src="img/pane_rustico.png" alt="Pane rustico">
                <input type="radio" name="pane" value="rustico" data-prezzo="3"> Pane rustico
            </label>
        </fieldset>

        <!-- Scelta Carne -->
        <fieldset>
            <legend>Scegli la carne</legend>
            <label>
                <img src="img/manzo.png" alt="Manzo">
                <input type="radio" name="carne" value="manzo" data-prezzo="4" required> Manzo
            </label>
            <label>
                <img src="img/pollo.png" alt="Pollo">
                <input type="radio" name="carne" value="pollo" data-prezzo="3.5"> Pollo
            </label>
            <label>
                <img src="img/vegano.png" alt="Vegano">
                <input type="radio" name="carne" value="vegano" data-prezzo="3"> Vegano
            </label>
        </fieldset>

        <!-- Toppings -->
        <fieldset>
            <legend>Scegli i tuoi toppings (4 inclusi)</legend>
            <label><img src="img/pomodoro.png" alt="Pomodoro"><input type="checkbox" name="toppings[]" value="Pomodoro" data-prezzo="0.5"> Pomodoro</label>
            <label><img src="img/insalata.png" alt="Insalata"><input type="checkbox" name="toppings[]" value="Insalata" data-prezzo="0.5"> Insalata</label>
            <label><img src="img/formaggio.png" alt="Formaggio"><input type="checkbox" name="toppings[]" value="Formaggio" data-prezzo="0.5"> Formaggio</label>
            <label><img src="img/bacon.png" alt="Bacon"><input type="checkbox" name="toppings[]" value="Bacon" data-prezzo="0.5"> Bacon</label>
            <label><img src="img/cipolla.png" alt="Cipolla"><input type="checkbox" name="toppings[]" value="Cipolla" data-prezzo="0.5"> Cipolla</label>
            <label><img src="img/uovo.png" alt="Uovo"><input type="checkbox" name="toppings[]" value="Uovo" data-prezzo="0.5"> Uovo</label>
        </fieldset>

        <!-- Salse -->
        <fieldset>
            <legend>Scegli le salse (3 incluse)</legend>
            <label><img src="img/ketchup.png" alt="Ketchup"><input type="checkbox" name="salse[]" value="Ketchup" data-prezzo="0.5"> Ketchup</label>
            <label><img src="img/maionese.jpg" alt="Maionese"><input type="checkbox" name="salse[]" value="Maionese" data-prezzo="0.5"> Maionese</label>
            <label><img src="img/senape.png" alt="Senape"><input type="checkbox" name="salse[]" value="Senape" data-prezzo="0.5"> Senape</label>
            <label><img src="img/bbq.png" alt="BBQ"><input type="checkbox" name="salse[]" value="BBQ" data-prezzo="0.5"> BBQ</label>
            <label><img src="img/burger.png" alt="Burger"><input type="checkbox" name="salse[]" value="Burger" data-prezzo="0.5"> Burger</label>
        </fieldset>

        <!-- Bevanda -->
        <fieldset>
            <legend>Scegli la bevanda</legend>
            <select name="bevanda" id="bevanda">
                <option value="Nessuna" data-prezzo="0">Nessuna bevanda</option>
                <option value="Acqua" data-prezzo="1">Acqua</option>
                <option value="Cocacola" data-prezzo="2">Coca-Cola</option>
                <option value="Fanta" data-prezzo="2">Fanta</option>
                <option value="Pepsi" data-prezzo="2">Pepsi</option>
                <option value="Monster" data-prezzo="3">Monster (POWER +10)</option>
            </select>
        </fieldset>

        <!-- Prezzo Totale -->
        <div class="price-box">
            Prezzo Totale: <span id="totale">0.00</span> ‚Ç¨
        </div>

         <input type="hidden" name="totaleFinale" id="totaleFinaleHidden" value="0.00">


        <button type="submit">Continua ‚Üí</button>
    </form>

    <footer>
        Creato da Manuz, per qualsiasi problema ESITATE a contattarmi
    </footer>

    <script>
        const form = document.getElementById('burgerForm');
        const totaleSpan = document.getElementById('totale');

        function calcolaPrezzo() {
            let totale = 0;

            const radioGroups = form.querySelectorAll('input[type="radio"]:checked');
            radioGroups.forEach(el => totale += parseFloat(el.dataset.prezzo));

            const toppings = form.querySelectorAll('input[name="toppings[]"]:checked');
            let extraToppings = Math.max(0, toppings.length - 4);
            totale += extraToppings * 1;

            const salse = form.querySelectorAll('input[name="salse[]"]:checked');
            let extraSalse = Math.max(0, salse.length - 3);
            totale += extraSalse * 1;

            const bevanda = document.querySelector('#bevanda option:checked');
            totale += parseFloat(bevanda.dataset.prezzo);

            totaleSpan.textContent = totale.toFixed(2);
            document.getElementById('totaleFinaleHidden').value = totale.toFixed(2);
        }



        form.addEventListener('change', calcolaPrezzo);
        window.addEventListener('DOMContentLoaded', calcolaPrezzo);
    </script>
    <script>
        // Funzioni cookie
        function setCookie(name, value, days) {
            let d = new Date();
            d.setTime(d.getTime() + (days*24*60*60*1000));
            document.cookie = name + "=" + encodeURIComponent(value) + ";expires=" + d.toUTCString() + ";path=/";
        }

        function getCookie(name) {
            let nameEQ = name + "=";
            let ca = document.cookie.split(';');
            for(let i=0;i<ca.length;i++) {
                let c = ca[i];
                while (c.charAt(0)==' ') c = c.substring(1,c.length);
                if (c.indexOf(nameEQ) == 0) return decodeURIComponent(c.substring(nameEQ.length,c.length));
            }
            return null;
        }

        // Funzione per salvare preferenze
        function salvaPreferenze() {
            const formData = new FormData(form);
            const obj = {};
            formData.forEach((value, key) => {
                if (obj[key]) {
                    if (Array.isArray(obj[key])) obj[key].push(value);
                    else obj[key] = [obj[key], value];
                } else obj[key] = value;
            });
            setCookie('preferenzeBurger', JSON.stringify(obj), 7); // salva 7 giorni
        }

        // Carica preferenze dai cookie
        function caricaPreferenze() {
            const cookie = getCookie('preferenzeBurger');
            if (!cookie) return;
            const obj = JSON.parse(cookie);

            for (const key in obj) {
                const value = obj[key];
                if (Array.isArray(value)) {
                    value.forEach(v => {
                        const el = form.querySelector(`[name="${key}[]"][value="${v}"]`);
                        if (el) el.checked = true;
                    });
                } else {
                    const elRadio = form.querySelector(`[name="${key}"][value="${value}"]`);
                    if (elRadio) elRadio.checked = true;

                    const elSelect = form.querySelector(`[name="${key}"]`);
                    if (elSelect) elSelect.value = value;
                }
            }
        }

        form.addEventListener('change', () => {
            calcolaPrezzo();
            salvaPreferenze();
        });

        window.addEventListener('DOMContentLoaded', () => {
            caricaPreferenze();
            calcolaPrezzo();
        });
</script>

</body>
</html>
